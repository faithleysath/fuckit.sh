import * from "../utils/json.ab"

// Example usage
main {
    echo "--- Testing safe_escape_json ---"
    let saying = "He said: \"Hi\"\nNew line with\\ a backslash"
    let expected_escape = "\"He said: \\\"Hi\\\"\\nNew line with\\\\ a backslash\""
    
    let escaped = trust safe_escape_json(saying)
    echo "Original: {saying}"
    echo "Escaped:  {escaped}"
    if escaped != expected_escape {
        echo "Error: Unexpected escape result!"
        exit 1
    }
    echo "Escape test passed!"

    echo "\n--- Testing extract_json_value ---"
    let json_str = "\{\"says\": {escaped}, \"nested\": \{\"a\": [1, 2]}}"
    echo "JSON: {json_str}"

    let extracted_says = trust extract_json_value(json_str, "says")
    echo "Extracted 'says': {extracted_says}"
    if extracted_says != saying {
        echo "Error: Unexpected extraction result for 'says'!"
        exit 1
    }

    let extracted_nested = trust extract_json_value(json_str, "nested.a.1")
    echo "Extracted 'nested.a.1': {extracted_nested}"
    if extracted_nested != "2" {
        echo "Error: Unexpected extraction result for 'nested.a.1'!"
        exit 1
    }
    echo "Extraction tests passed!"
}
